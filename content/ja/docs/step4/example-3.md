---
title: "問題3: バグ修正"
categories: [実践演習, GitHub Copilot]
tags: [debug, bugfix, search, react]
weight: 3
---

## 前提条件

この演習を始める前に、検索ページの機能を含む `add-search` ブランチの内容を `main` ブランチにマージする必要があります。

### 📋 事前準備手順

```bash
# 1. main ブランチにいることを確認
git checkout main

# 2. 最新のリモート情報を取得
git fetch origin

# 3. add-search ブランチの内容を main にマージ
git merge origin/add-search

# 4. 依存関係のインストール
npm install

# 5. 開発サーバーを起動して検索ページが利用可能か確認
npm run dev
# ブラウザで http://localhost:3000/search にアクセスして検索ページが表示されることを確認
```

> **💡 重要**
> 検索ページ（`/search`）が正常に表示されることを確認してから次の問題に進んでください。もしページが表示されない場合は、マージが正常に完了していない可能性があります。

---

## 問題

検索ページに複数のバグが混入しており、ユーザーから以下の不具合報告が上がっています。
GitHub Copilot を活用してこれらのバグを効率的に特定・修正してください。

### 🚨 報告されている不具合

![バグ報告](../images/bug-report.png)

1. **統計表示の異常**: 高優先度のTodoがあるはずなのに、統計欄の「🔥 高優先度」が常に0件と表示される
2. **検索機能の不具合**: 検索ボックスに文字を入力しても検索結果が更新されない
3. **リセット機能の不完全動作**: 「リセット」ボタンを押してもソート順がリセットされない

> **💡 学習のポイント**
> この演習では、まず **1つのバグ（高優先度統計）** を例に修正方法を習得します。修正完了後、同じアプローチを他のバグ（検索機能、リセット機能）にも応用していきます。

### 🎯 ゴール

以下の3つのバグをすべて修正し、検索ページが正常に動作することがゴールです：

1. **統計機能の修正**
   - 高優先度Todoの件数が正しく表示される
   - 統計情報がリアルタイムで更新される

2. **検索機能の修正**
   - 検索ボックスへの入力に応じて即座に結果が絞り込まれる

3. **リセット機能の修正**
   - リセットボタンで検索条件、フィルター、ソート順がすべて初期状態に戻る
   - 「新しい順」に正しくリセットされる

### ✅ ゴールの確認方法

以下の手順をすべて実行して問題がなければゴール達成です：

#### 1. 基本動作確認

**手順1: 検索ページにアクセス**
```bash
npm run dev
# ブラウザで http://localhost:3000/search にアクセス
```

**手順2: 事前準備**
- メインページでいくつかのTodoを作成（優先度を「高」「中」「低」で分散）
- 検索ページで動作確認を実施

#### 2. バグ修正の確認

**統計機能のテスト**
- [ ] 高優先度のTodoを作成後、統計欄の「🔥 高優先度」に正しい件数が表示される
- [ ] Todoの優先度を変更すると統計がリアルタイムで更新される

**検索機能のテスト**
- [ ] 検索ボックスに文字を入力すると即座に結果が絞り込まれる

**リセット機能のテスト**
- [ ] 検索条件、フィルター、ソート順を設定した状態でリセットボタンをクリック
- [ ] すべての条件が初期状態（検索欄：空、優先度：すべて、ステータス：すべて、ソート：新しい順）にリセットされる

**ゴール達成の判定:**
上記すべての項目にチェックが付けばゴール達成です！

> **📝 次のステップ**
> 3つのバグをすべて修正できたら、今回学んだアプローチを他のプロジェクトでも応用してみてください。GitHub Copilotを活用した効率的なバグ修正手法は、あらゆる開発場面で威力を発揮するはずです。

---

## 📋 進め方

> **💡 重要な注意事項**
> 以下に示す進め方は**一例**です。本ハンズオンを通して学んだGitHub Copilotの活用方法や効果的な指示の出し方を活かして、**あなた自身の方法でバグ修正まで進めてください**。
>
> **今回の例について：**
> - 解説の簡潔性のため、**高優先度統計バグ**を例に修正手順を示します
> - **検索機能**と**リセット機能**のバグも、同様のアプローチで修正してください
> - 各バグに対して段階的なデバッグを適用することが重要です
>
> **推奨アプローチ：**
> - これまでの演習で身につけた `#codebase`、エラーメッセージの活用などのパターンを応用する
> - バグの特定から修正まで段階的に進める指示の出し方を工夫する
> - テストによる動作確認の方法を自分なりに考える
>
> 下記の手順は参考として活用し、より効果的だと思う方法があれば積極的に試してみてください。

#### Step 1: バグの特定と分析

1. **高優先度統計バグの現象確認**
   ```markdown
   #codebase

   検索ページで「高優先度のTodoがあるのに統計の『高優先度』が0件と表示される」という不具合が報告されています。

   統計計算に関連するコード箇所を特定し、問題の原因を分析してください。
   ```

#### Step 2: 高優先度統計バグの修正

1. **統計機能のバグ修正**
   ```markdown
   #codebase

   先ほど特定した統計計算の問題を修正してください。

   【期待する動作】
   - 優先度が「high」のTodoが存在する場合、統計欄に正しい件数が表示される
   - TodoのCRUD操作に応じて統計がリアルタイムで更新される

   修正内容とその理由を説明してください。
   ```

#### Step 3: 修正の検証とテスト

1. **統計機能の詳細検証**
   ```markdown
   #codebase

   修正した統計機能が正しく動作することを、テストを書いて詳しく検証してください：

   【検証項目】
   1. 統計機能：優先度別の件数が正確に表示されるか
   2. リアルタイム更新：Todoの優先度変更時に統計が即座に更新されるか
   3. エッジケース：高優先度Todoが0件の場合も正しく「0件」と表示されるか

   各項目について検証結果を報告してください。
   ```

2. **TypeScriptエラーチェック**
   ```bash
   # TypeScriptの型チェック
   npx tsc --noEmit

   # 開発サーバーでの動作確認
   npm run dev
   ```

#### Step 4: 最終確認と他バグへの応用

```markdown
#codebase

統計バグの修正が完了したら、以下の最終確認を行ってください：

【最終チェック項目】
- 統計表示の正確性（特に高優先度の件数）
- 他の統計項目（中優先度、低優先度）への影響がないこと
- 検索・フィルター機能への影響がないこと

すべて正常に動作することを確認したら、統計バグの修正完了です。
```

**次の課題への応用:**
統計バグの修正が完了したら、同じアプローチを使って他のバグも修正してみてください：

1. **検索機能のバグ**: 検索ボックスに入力しても結果が更新されない
2. **リセット機能のバグ**: リセットボタンを押してもソート順がリセットされない

今回学んだ以下の手法が他のバグにも応用できます：
- `#codebase` を使った問題箇所の特定
- 段階的な問題の切り分け
- TypeScript エラーの活用
- React Hook の依存関係チェック

---

## ヒント

### 💡 効率的なバグ修正アプローチ

**1. 関連しそうなファイル、シンボルをコンテキストとして与える**

バグ修正を効率的に進めるには、まず関連する情報を整理してCopilotに提供することが重要です。

```markdown
#file:SearchApp.tsx

検索ページで統計表示がおかしい問題があります。特に統計計算の部分と、それに関連するuseMemoの使い方について確認したいです。
```

この方法により、Copilotは関連するコードを把握して的確なアドバイスを提供できます。

**2. 段階的なデバッグ**

一度にすべてを解決しようとせず、段階的に問題を切り分けて進めることが重要です。

```markdown
まず統計機能のバグだけを修正し、動作確認後に次のバグに取り組んでください。
修正の際は、変更理由と期待される動作も併せて説明してください。
```

**3. バグ解消用のプロンプトファイル・カスタムエージェントの活用**

バグ修正の効率を上げるために、専用のプロンプトファイルやカスタムエージェントを作成するのも効果的です。

**自作プロンプトファイルの例：**

```markdown
---
mode: agent
description: "バグ修正専用プロンプト"
---

# バグ修正アシスタント

以下のバグを段階的に修正してください：

【バグの概要】
${input:bugDescription:バグの説明}

【修正手順】
1. 問題の再現と原因特定
2. 修正コードの実装
3. テストによる検証
4. 副作用の確認

修正理由と変更内容を詳しく説明してください。
```

**コミュニティリソースの活用：**

GitHub Copilotコミュニティには、バグ修正に役立つリソースが豊富に用意されています：

- **Debug Mode**: 系統的なデバッグフローをサポート
- **Critical thinking mode**: 問題の根本原因を深く分析

これらのリソースは [awesome-copilot](https://github.com/github/awesome-copilot) からワンクリックでインポートできます。バグ修正作業の標準化や品質向上に活用してみてください。


この演習を通じて、GitHub Copilotを活用した効率的なバグ修正手法を習得できます。**関連コンテキストの提供**、**段階的なデバッグ**、**専用プロンプト・カスタムエージェントの活用** という3つのアプローチを組み合わせることで、複雑なバグも系統的に解決できるようになります。


---
title: ⑤ トラブルシュート手順書の作成
categories: [運用, GitHub Copilot]
weight: 5
---

運用現場では、**ライブラリ不足**などのコード起因だけでなく、**環境設定**や**アクセス権**といった外部要因によるエラーが発生することがよくあります。ここでは、**本番サーバーでの環境変数**が設定されておらずアプリが起動に失敗した例をもとに、**GitHub Copilot** を使った「トラブルシュート手順書」の作成手順を紹介します。

---

### :pen: 例題 - 環境変数(DB_HOST)が未設定で起動失敗

#### シナリオ

- **Javaアプリ**を本番サーバーで起動しようとしたところ、**DB接続エラー**が発生  
- ログには「**DB_HOST not set or empty**」「Unknown host 'null'」というメッセージが出力  
- ローカル環境では動くが、本番サーバーでは落ちる → つまり **DB_HOST** 環境変数が設定されていない可能性が高い

##### プロンプト例

```text
Copilot, 下記ログと状況を参考に、
環境変数が未設定でアプリが起動失敗する問題に関する
トラブルシュート手順書をMarkdownで作ってください。

ログ抜粋:
"DB_HOST not set or empty"
"Unknown host 'null'"

状況:
- 本番サーバーでJavaアプリを起動中
- DB_HOSTが設定されていない

手順書には以下を含めて:
1) 原因の概要
2) 対処手順(例: Linux環境で環境変数を設定する方法)
3) 再発防止策
```

---

### :robot: 出力例

```markdown
# トラブルシュート手順書 - 環境変数(DB_HOST)未設定による起動失敗

## 1. 原因の概要
- アプリの起動時に `DB_HOST` 環境変数が設定されておらず、ログに "DB_HOST not set or empty" と記録
- DB接続先が null 扱いとなり、接続エラーが発生

## 2. 対処手順

### 2-1. Linux 環境での環境変数設定
1. サーバーにSSHでログイン
2. `~/.bashrc` などに以下を追記 (例):
   export DB_HOST="your-db-hostname"
3. `. ~/.bashrc` を実行して反映し、再度アプリを起動
4. Systemd経由で起動している場合は、`/etc/systemd/system/myapp.service` に Environment設定を追加する方法も可

### 2-2. Dockerコンテナ環境で設定する場合
1. Docker run 時に `-e` オプションを使う:
   docker run -e DB_HOST="your-db-hostname" -p 8080:8080 myjavaapp:latest
2. `docker-compose.yml` を使う場合は環境変数セクションに `DB_HOST: "your-db-hostname"` を追加

### 2-3. Javaコード側の確認
- `System.getenv("DB_HOST")` が正しく値を取得できるかログ出力
- 必須の環境変数が無い場合は起動時にエラー表示するなどの処理を入れる

## 3. 再発防止策
1. **環境変数の事前チェック**  
   - 起動スクリプトやCI/CDパイプラインで `DB_HOST` が設定されているか検証
2. **ドキュメント化**  
   - この設定内容を運用手順書やReadmeに明記し、オンボーディング時に参照
3. **ローカルと本番の差分管理**  
   - local-envファイルと本番サーバーの設定を比較しやすくする
```

Copilot は**原因の概要**と**対処手順**（例: Linuxでの環境変数設定 / Docker実行時の `-e` オプション / Java側の確認）をMarkdown形式でまとめて提案してくれます。

---

### :memo: 練習

1. **長いログからの抜粋**  
   - より多くのエラー行がある場合、それを含めて「ログ内容も一緒に要約して」と依頼
2. **Pull Request で手順書をレビュー**  
   - Copilot が作成したMarkdownをチームでレビュー＆加筆 →　Wiki などに共有
3. **ターミナルで起きた問題をもとに手順書を作成**  
   - 「#terminalSelection」を使い、実際に自分が行った作業をもとにトラブルシュート手順を作成させるのも有効
---

## まとめ

- **環境変数未設定**などの環境起因トラブルでも、**Copilot** に「原因+ログ」を渡すと**Markdown手順書**をすばやく生成  
- Linux環境やDockerなど、**一般的な設定手順**をコードブロック付きで提案  
- 最終的な**内容チェック**は人間が行い、チームで合意 → 運用手順書として共有  

こうして、運用フェーズでよくある**環境設定ミス**にも、**Copilot** を活用して**スピーディに対処手順**をまとめ、**再発防止**にも役立ちます。

---
title: ④ テスト実装・品質保証
categories: [GitHub Copilot, 技術者向け]
tags: [test, quality, jest, testing-library]
weight: 4
---

GitHub Copilotを活用して効率的にテストコードを実装し、コード品質を向上させる手法を学びます。これまでのシナリオで理解したプロジェクト構造・設計した機能・実装したコードに対する包括的なテスト戦略を構築します。

---

## 1. プロンプトファイルによるテスト雛形生成

基本的なテストコードの雛形は、プロンプトファイルを活用することで効率的に生成できます。

### :pen: 例題 - テスト雛形生成用プロンプトファイルの活用

```
#file:.github/prompts/component-test.prompt.md を参照して、DeleteConfirmModalコンポーネントのテスト雛形を生成してください。

コンポーネント名: DeleteConfirmModal
テストファイルパス: src/components/__tests__/DeleteConfirmModal.test.tsx

以下の基本テストケースを含む雛形を生成してください：
1. レンダリングテスト
2. プロパティによる表示制御テスト
3. ユーザーインタラクション（ボタンクリック）テスト
4. キーボードイベントテスト
5. アクセシビリティ基本テスト
```

### :robot: 出力例

```
実際に試してみた結果をここに記載してください
```

### プロンプトファイルの設定例

`.github/prompts/component-test.prompt.md` の内容例：

```markdown
---
mode: agent
description: "Reactコンポーネントテスト雛形生成"
tools: ["createFile"]
---

# Reactコンポーネントテスト雛形生成

${input:componentName:コンポーネント名} のテストファイルを生成してください。

## 生成要件
- React Testing Library使用
- TypeScript対応
- describe/it構造で整理
- モックとスパイの適切な活用

## 基本テストケース
### 正常系テスト
- コンポーネントの正常なレンダリング
- Propsによる表示内容の変化
- ユーザーインタラクションの正常動作
- 状態変更の正常フロー

### 異常系テスト
- 無効なPropsでのエラーハンドリング
- ネットワークエラー時の挙動
- 予期しない状態での動作確認
- エッジケースでの安全性

### アクセシビリティテスト
- ARIA属性の適切な設定
- キーボードナビゲーション
- フォーカス管理
- スクリーンリーダー対応

## ファイル配置
- テストファイル: src/components/__tests__/${componentName}.test.tsx
- 適切なimport文とsetup
```

### :memo: プロンプトファイル活用のメリット

- **一貫性**: 同じ構造のテストファイルを継続的に生成
- **効率性**: 基本的な雛形作成時間の大幅短縮
- **標準化**: チーム全体で統一されたテストパターン
- **再利用性**: 異なるコンポーネントで同じプロンプトを活用

> 💡 **Tips: テスト用インストラクションズファイル**
>
> より一貫したテストを書くために、以下のファイルを作成することを推奨します：
>
> **`.github/copilot-instructions-testing.md`**
> ```markdown
> ---
> applyTo: "**/*.test.tsx,**/*.test.ts,**/*.spec.tsx,**/*.spec.ts"
> description: "テストファイル専用のコーディングガイドライン"
> ---
>
> # テスト専用のコーディングガイドライン
>
> ## テスト実装の基本方針
> - React Testing Libraryを優先使用
> - ユーザー視点でのテストを重視
> - describe/itによる階層構造
> - モックは最小限に留める
>
> ## テストファイル構成
> - AAA（Arrange/Act/Assert）パターンを遵守
> - テストデータはファクトリー関数で生成
> - 共通セットアップは beforeEach で実装
>
> ## テストカテゴリ別ガイドライン
> ### 正常系テスト
> - 期待される動作の確認
> - 典型的なユーザー操作の検証
> - 正常なデータフローの確認
>
> ### 異常系テスト
> - エラーハンドリングの確認
> - バリデーション機能の検証
> - 予期しない状況での安全性確認
>
> ### エッジケースの考慮
> - 境界値テスト
> - 空データでの動作確認
> - 大量データでのパフォーマンス確認
> ```
>
> この設定により、テストファイルでCopilotを使用する際に自動的に適切なガイドラインが適用されます。
>

---

## 2. 単体テスト実装

コンポーネント・関数・カスタムフック単位でのテスト実装手法を学びます。

### :pen: 例題 - DeleteConfirmModalコンポーネントの単体テスト

```
設計したsrc/components/DeleteConfirmModal.tsxの単体テストを実装してください。以下の要件を満たしてください：

1. **基本レンダリングテスト**
   - isOpen=trueの時にモーダルが表示される
   - isOpen=falseの時にモーダルが非表示になる
   - todoTitleが正しく表示される

2. **ユーザーインタラクションテスト**
   - 「削除する」ボタンクリック時にonConfirmが呼ばれる
   - 「キャンセル」ボタンクリック時にonCancelが呼ばれる
   - ESCキー押下時にonCancelが呼ばれる

3. **アクセシビリティテスト**
   - 適切なARIA属性が設定されている
   - モーダル表示時にフォーカスが移動する
   - タブナビゲーションが適切に動作する

React Testing Libraryのベストプラクティスに従い、ユーザー視点でのテストを作成してください。
```

### :robot: 出力例

```
実際に試してみた結果をここに記載してください
```

---

## 3. 統合テスト実装

複数のコンポーネントやAPIとの連携を含む統合テストの実装手法を学びます。

### :pen: 例題 - 削除確認フローの統合テスト

```
Example-2で設計したTodo削除確認機能の統合テストを実装してください：

1. **削除フロー全体のテスト**
   - TodoItemで削除ボタンをクリック
   - DeleteConfirmModalが表示される
   - 「削除する」ボタンで削除実行
   - TodoリストからTodoが削除される

2. **キャンセルフローのテスト**
   - 削除ボタンクリック後のモーダル表示
   - 「キャンセル」ボタンでモーダルクローズ
   - Todoが削除されずに残っている

3. **キーボード操作のテスト**
   - ESCキーでのモーダルクローズ
   - Enterキーでの削除実行（フォーカス時）

4. **複数Todo環境でのテスト**
   - 正しいTodoが削除される
   - 他のTodoに影響がない

MSW（Mock Service Worker）を使用してAPIをモックし、実際のユーザー操作フローをテストしてください。
```

### :robot: 出力例

```
実際に試してみた結果をここに記載してください
```

---

## 4. テストカバレッジの最適化

テストカバレッジを効率的に向上させる手法を学びます。

### :pen: 例題 - カバレッジ分析と改善

```
GHCP-TodoAppプロジェクトのテストカバレッジを分析し、改善提案をしてください：

1. 現在のカバレッジレポートの解析
2. カバレッジが不足している箇所の特定
3. 優先度の高いテスト追加箇所の特定
4. カバレッジ向上のための効率的なテスト実装
5. カバレッジ目標の設定と段階的改善計画
6. CI/CDでのカバレッジ監視設定

jest --coverage等を使用したカバレッジ分析と改善手順を具体的に示してください。
```

### :robot: 出力例

```
実際に試してみた結果をここに記載してください
```

---

## 5. 練習

以下の練習問題に取り組んで、テスト実装のスキルを向上させましょう。GHCP-TodoAppプロジェクトを使用して実際に試してみてください。

### 基本練習（初級）

1. **プロンプトファイルの基本活用**
   - component-test.prompt.mdを使用してテスト雛形を生成する
   - 生成された雛形を理解し、基本的なテストケースを実装する

2. **削除確認モーダルの基本テスト**
   - DeleteConfirmModalコンポーネントの単体テストを作成する
   - React Testing Libraryの基本的な使用方法を習得する

3. **インストラクションズファイルの作成**
   - テスト専用の.github/copilot-instructions-testing.mdを作成する
   - プロジェクト固有のテストガイドラインを定義する

### 中級練習

4. **削除確認フローの統合テスト**
   - TodoItem → DeleteConfirmModal → Todo削除の一連のフローテストを実装する
   - 複数コンポーネント間の連携テストを作成する

5. **非同期処理のテスト**
   - 削除API通信を含むコンポーネントのテストを実装する
   - MSWを使用したAPIモックの作成と活用

6. **モーダルのアクセシビリティテスト**
   - フォーカス管理とキーボード操作のテストを実装する
   - ARIA属性の適切な設定をテストする

### 上級練習

7. **プロンプトファイルのカスタマイズ**
   - 独自のテスト雛形生成用プロンプトファイルを作成する
   - プロジェクト固有のテストパターンに対応したプロンプトを設計

8. **削除機能のパフォーマンステスト**
   - モーダル表示・非表示のレンダリングパフォーマンステストを実装する
   - 大量Todoでの削除操作パフォーマンス測定

9. **削除機能のテストカバレッジ最適化**
   - 削除確認モーダル関連コードのカバレッジ不足箇所を特定
   - 効率的なテスト追加と改善計画の策定

### 実践練習

10. **テスト戦略の策定**
    - プロジェクト全体のテスト戦略ドキュメントを作成する
    - テストピラミッドに基づいた適切なテスト配分の計画

11. **プロンプトファイルライブラリの構築**
    - 様々なコンポーネントタイプ用のプロンプトファイルセットを作成する
    - チーム全体で再利用可能なテストテンプレート集を構築

12. **テストデータ管理**
    - テスト用のフィクスチャとファクトリーパターンを実装する
    - テストデータの再利用と保守性の向上

### 総合練習

13. **包括的テスト設計**
    - テストカバレッジやコード品質の基準を設定する
    - 品質基準を満たすためのテスト実装計画を策定

14. **テストのリファクタリング**
    - 既存テストの重複排除と再構成を行う
    - テストの保守性とパフォーマンス向上

15. **包括的テスト計画**
    - 新機能追加時のテスト計画策定から実装までの一連の流れを実践する
    - プロンプトファイルを活用したテスト開発プロセスの確立

---

## 6. まとめ

GitHub Copilotを活用することで、テスト実装の効率と品質を大幅に向上できます：

### 習得したスキル
- **プロジェクト概要把握**: 既存テスト戦略の理解とカバレッジ分析
- **個別ファイル把握**: コンポーネント・機能単位のテスト設計
- **実装パターン調査**: 一貫したテストパターンの適用
- **単体テスト**: React Testing Libraryを使用した効率的なテスト実装
- **統合テスト**: MSWを活用したAPI連携テスト
- **プロンプトファイル活用**: テスト雛形の効率的な生成
- **テストカバレッジ最適化**: 包括的な品質管理

### 実践でのメリット
- **品質保証の自動化**: 手動テストからの脱却
- **リグレッション防止**: 継続的な品質監視
- **開発効率向上**: プロンプトファイルによるテスト実装時間の短縮
- **コードの信頼性向上**: 包括的なテストカバレッジ
- **チーム全体の品質意識向上**: 統一されたテスト戦略とプロンプトファイル

### 次のステップ
- **Example-5**: 削除確認モーダルも含めたコードレビュー自動化を学習
- **実践応用**: Example-2で設計した機能のテスト戦略策定と実行
- **チーム共有**: 削除確認機能のテストベストプラクティスとプロンプトファイルの横展開
